# 目标
1.更高的准确率
2.更少的检查花费

# 设计
## 一. 有针对性的对疾病典型特征的评估：
1. 先根据已知的基本信息，调用llm提取出与疾病相关的典型特征。
2. 再根据这些典型特征，让llm评估可能的几种疾病种类。
3. 对每种疾病，让llm输出此疾病除了已知的基本信息外，还需要哪些典型特征来进一步确认诊断。每个典型特征应有权值，表示其对确诊的影响力。
4. 以上信息要求llm全部以json格式输出，形成一个json表。每个特征除了权值，还需要有一个状态值，表示病人是否有这个特征（-100表示与此特征表现完全相反，0表示未确认或未知，100表示完全符合此特征）。
5. 要求llm根据这个json表，总结出待确认的所有典型特征，考虑权值大小、冲突程度（例如两种疾病有相反的特征）、检查难度和开销，给出一个优先级排序，作为后续检查的依据。
6. 根据此优先级排序开始问诊或检查。每次问诊或检查后，更新已知基本信息和json表，重新计算优先级排序，直到某种疾病的确诊概率超过某个阈值（例如90%），或者达到最大问诊次数。若表中的每种疾病的确诊概率都低于某个阈值（例如0%，因为状态值可能为负数），则重新评估可能的疾病种类，重复上述过程。

- 以上过程中，需要保证llm输出内容的可维护性，需要维护的内容尽量以json格式输出，方便后续处理。
- 以上过程中，对llm的调用，需要考虑上下文长度，只给对应步骤的llm需要的上下文，避免给llm过多无关信息。
- 关于问诊、检查、最终诊断，仍需符合agentclinic.py的框架设计，即保证与普通doctor的兼容性。

## 二. 构建检查的类间转移关系：
1. 人工对检查进行分类，构建检查的类间转移关系图，用于表示一般情况下检查流程的递进关系。费用较低较为基本的检查在前，逐步向费用较高，较为复杂精细的检查递进。
2. 在llm给出检查决策后，先不直接执行该检查，而是判断该检查在转移关系图中是否有前驱检查，若有，则建议模型先执行前驱检查，若无，则直接执行该检查。

- 以上过程中，先执行前驱检查不是强制性的，若llm认为病例有紧迫性或特殊性，仍可以直接执行某检查。
- 以上过程中，若llm经过评估认为确实应该先执行前驱检查，应对相关上下文进行压缩，简要说明决策原因，避免给llm过多无关信息。
- 以上过程中，仍需符合agentclinic.py的框架设计，即保证与普通doctor的兼容性。

## 三. 整体要求
1. llm的query尽量解耦，每次query只做一件事，避免一次query做过多事情，导致输出内容混乱，难以维护。每次的输入和期望输出都应控制在合理长度
2. llm的输出内容尽量结构化，方便后续处理和维护。
3. 以上设计的实现，尽量不影响现有的agentclinic.py框架设计，保证与普通doctor的兼容性。